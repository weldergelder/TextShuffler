'use strict';

module.exports = (XML, element, preserve, callback) => {
  if (XML && typeof XML === 'string') {
    if (element && XML.includes(element)) {
      const opening = `<${element}`;
      const closing = `</${element}>`;
      var elements = XML.split(opening);

      //Dictionary API will show type of word on <fl> tag
      //loop commented out so that we only pick up the first tag
//      elements.forEach((value) => {

        var value = elements[1];
        if (value && value.includes(closing)) {
          const i = value.indexOf('>') + 1;
          const j = value.indexOf(closing);
          const attribute = value.substr(0, i - 1);
          value = value.substr(i, j - i);

          if (preserve) {
            value = `${opening}${attribute}>${value}${closing}`;
          }

          callback(null, value);
        }
//      });
    }
    else {
      //took out the error so that if the <fl> tag isn't there
      //it would default to noun (word has no definition)
      callback(null, 'noun');
    }
  }
  else {
    //changed error message text for simplicity's sake
    callback('We couldn\'t shuffle your words, make sure you\'re online!');
  }
};